app.directive("orionAssignerHost",["OrionAssignerController","$rootScope","$q","$timeout","Message","$interval",function(e,t,o,n,r,s){return{restrict:"E",templateUrl:"/core/common/modules/Orion/Host/orionAssignerHost.html",link:function(i,c,a){var u,g=new OrionHost;n(function(){u=s(i.isAssignerRunning,1e4,0,!1)},2e3),i.becomeAssignerHost=function(){var n=o.defer();return e.on().then(function(){t.orionHostObject.item.assigner.status=!0,t.orionHostObject.item.assigner.user={key:t.userInfo.$key,name:t.userInfo.name},i.updateAssignerHostObject().then(function(){r.toast({text:"You are Hosting The Orion Assigner.",theme:"toast-info"})}).catch(function(e){n.reject(e),console.log(e),r.toast({text:"Hubo un error en becomeHost.",theme:"toast-red"})})}).catch(function(e){console.log(e)}),n.promise},i.updateAssignerHostObject=function(){var e=o.defer(),n=g.db.ref.root.child("orion/host"),r={assigner:t.orionHostObject.item.assigner,executioner:t.orionHostObject.item.executioner,latestServerTS:firebase.database.ServerValue.TIMESTAMP};return n.update(r).then(function(){e.resolve(!0)}).catch(function(t){e.reject(t)}),e.promise},i.isAssignerRunning=function(){var o=6e4,n=new Server(g.db.ref.root);n.getLatestTS().then(function(n){var r=new Date(t.orionActivityObject.item.assigner),s=new Date(n);return s-r<=o||(t.orionHostObject.item.assigner.status=!1,t.orionHostObject.item.assigner.user=null,i.updateAssignerHostObject(),e.off(),!1)}).catch(function(e){console.log(e)})}}}}]);