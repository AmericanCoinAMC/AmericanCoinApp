app.directive("orionExecutionerHost",["OrionExecutionerController","$rootScope","$q","$timeout","Message","$interval",function(e,t,o,n,r,i){return{restrict:"E",templateUrl:"/core/common/modules/Orion/Host/orionExecutionerHost.html",link:function(c,u,s){var a,f=new OrionHost;n(function(){a=i(c.isExecutionerRunning,1e4,0,!1)},2e3),c.becomeExecutionerHost=function(){var n=o.defer();return e.on().then(function(){t.orionHostObject.item.executioner.status=!0,t.orionHostObject.item.executioner.user={key:t.userInfo.$key,name:t.userInfo.name},c.updateExecutionerHostObject().then(function(){r.toast({text:"You are Hosting The Orion Executioner.",theme:"toast-info"})}).catch(function(e){n.reject(e),console.log(e),r.toast({text:"Hubo un error en becomeHost.",theme:"toast-red"})})}).catch(function(e){console.log(e)}),n.promise},c.updateExecutionerHostObject=function(){var e=o.defer(),n=f.db.ref.root.child("orion/host"),r={assigner:t.orionHostObject.item.assigner,executioner:t.orionHostObject.item.executioner,latestServerTS:firebase.database.ServerValue.TIMESTAMP};return n.update(r).then(function(){e.resolve(!0)}).catch(function(t){e.reject(t)}),e.promise},c.isExecutionerRunning=function(){var o=6e4,n=new Server(f.db.ref.root);n.getLatestTS().then(function(n){var r=new Date(t.orionActivityObject.item.executioner),i=new Date(n);return i-r<=o||(t.orionHostObject.item.executioner.status=!1,t.orionHostObject.item.executioner.user=null,c.updateExecutionerHostObject(),e.off(),!1)}).catch(function(e){console.log(e)})}}}}]);