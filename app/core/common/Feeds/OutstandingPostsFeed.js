app.factory("OutstandingPostsFeed",["$mdDialog",function(t){return{loadFeed:function(o){t.show({templateUrl:"/core/common/Feeds/outstandingPosts.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!0,fullscreen:!0,escapeToClose:!0,controller:["$rootScope","$scope","$mdDialog","$firebaseArray","PostDialogService","$timeout",function(t,o,a,i,n,r){o.loading=!0,o.firstLotSize=12,o.paginationLotSize=5,o.displayedItems=0,o.itemsRemaining=!0,o.paginating=!1,o.postsArray=[],o.firstLotLoaded=!1;var e=rootRef.child("outstandingPosts").orderByPriority().limitToFirst(o.firstLotSize);e.once("value").then(function(t){t.forEach(function(t){o.addPaginationItem(t)}),r(function(){o.loading=!1,o.firstLotLoaded=!0})}).catch(function(t){console.log(t)}),e.on("child_added",function(t){o.firstLotLoaded&&(o.arrayHasKey(t.key,o.postsArray)||(o.addPaginationItem(t),r(function(){o.sortArray()})))}),e.on("child_changed",function(t){o.firstLotLoaded&&(o.editPaginationItem(t),r(function(){o.sortArray()}))}),e.on("child_removed",function(t){o.firstLotLoaded&&(o.removePaginationItem(t),r(function(){o.sortArray()}))}),o.nextPaginationLot=function(){if(!o.paginating&&void 0!=o.postsArray[parseInt(o.displayedItems-1)]&&o.firstLotLoaded&&o.itemsRemaining){o.paginating=!0;var t=o.postsArray.length,a=rootRef.child("outstandingPosts").orderByPriority().startAt(o.postsArray[parseInt(o.displayedItems-1)].$priority+1).limitToFirst(o.paginationLotSize);a.once("value").then(function(a){a.forEach(function(t){o.addPaginationItem(t)}),r(function(){t==o.postsArray.length&&(o.itemsRemaining=!1),o.paginating=!1})}).catch(function(t){console.log(t)})}},o.addPaginationItem=function(t){o.postsArray.push({$id:t.key,url:t.val().url,title:t.val().title,description:t.val().description,image:t.val().image,content:t.val().content,eventDate:t.val().eventDate,outstanding:t.val().outstanding,scrapingDuration:t.val().scrapingDuration,source:t.val().source,hashtag:t.val().hashtag,$priority:t.getPriority()}),o.displayedItems+=1},o.arrayHasKey=function(t,o){for(var a=!1,i=0;i<o.length;i++)o[i].$id==t&&(a=!0);return a},o.editPaginationItem=function(t){for(var a=0;a<o.postsArray.length;a++)o.postsArray[a].$id==t.key&&(o.postsArray[a].url=t.val().url,o.postsArray[a].title=t.val().title,o.postsArray[a].image=t.val().image,o.postsArray[a].content=t.val().content,o.postsArray[a].eventDate=t.val().eventDate,o.postsArray[a].outstanding=t.val().outstanding,o.postsArray[a].scrapingDuration=t.val().scrapingDuration,o.postsArray[a].source=t.val().source,o.postsArray[a].hashtag=t.val().hashtag,o.postsArray[a].$priority=t.getPriority())},o.removePaginationItem=function(t){for(var a=0;a<o.postsArray.length;a++)o.postsArray[a].$id==t.key&&(o.postsArray.splice(a,1),o.displayedItems-=1)},o.sortArray=function(){o.postsArray.sort(function(t,o){return parseFloat(t.$priority)-parseFloat(o.$priority)})},o.displayPost=function(o,i){a.hide(),t.preloader=!0,r(function(){t.preloader=!1,n.displayPost(o,i)},700)},o.closeDialog=function(){o.restoreDefaults(),a.hide()},o.restoreDefaults=function(){o.postsArray=[],o.displayedItems=0,o.itemsRemaining=!0}}]})}}}]);