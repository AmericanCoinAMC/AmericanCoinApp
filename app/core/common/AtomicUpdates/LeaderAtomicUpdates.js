app.factory("LeaderAtomicUpdates",["$q","PostObjectService","LeaderObjectService",function(t,e,s){return{updateLeader:function(e){var s=t.defer();return this.getPostsArray(e).then(angular.bind(this,function(t){this.getUserPostRefs(e).then(angular.bind(this,function(o){var r={mainPostRefs:this.getMainPostRefs(t,e),sourcePostRefs:this.getSourcePostRefs(t,e),categoryPostRefs:this.getCategoryPostRefs(t,e),hashtagPostRefs:this.getHashtagPostRefs(t,e),leaderPostRefs:this.getLeaderPostRefs(t,e),outstandingPostRefs:this.getOutstandingPostRefs(t,e),userPostRefs:o},n=this.buildFanoutObject(e,r,"edit");rootRef.update(n).then(function(){s.resolve(!0)}).catch(function(t){s.reject(t)})})).catch(function(t){s.reject(t)})})).catch(function(t){s.reject(t)}),s.promise},deleteLeader:function(e){var s=t.defer();return this.getPostsArray(e).then(angular.bind(this,function(t){this.getUserPostRefs(e).then(angular.bind(this,function(o){var r={mainPostRefs:this.getMainPostRefs(t,e),sourcePostRefs:this.getSourcePostRefs(t,e),categoryPostRefs:this.getCategoryPostRefs(t,e),hashtagPostRefs:this.getHashtagPostRefs(t,e),leaderPostRefs:this.getLeaderPostRefs(t,e),outstandingPostRefs:this.getOutstandingPostRefs(t,e),userPostRefs:o},n=this.buildFanoutObject(e,r,"delete");rootRef.update(n).then(function(){s.resolve(!0)}).catch(function(t){s.reject(t)})})).catch(function(t){s.reject(t)})})).catch(function(t){s.reject(t)}),s.promise},buildFanoutObject:function(t,e,o){var r={},n={};"edit"==o&&(n=s.buildMinifiedAlt(t));for(var a=e.mainPostRefs,i=0;i<a.length;i++)r[a[i]]=n;for(var f=e.sourcePostRefs,i=0;i<f.length;i++)r[f[i]]=n;for(var u=e.categoryPostRefs,i=0;i<u.length;i++)r[u[i]]=n;for(var h=e.hashtagPostRefs,i=0;i<h.length;i++)r[h[i]]=n;for(var c=e.leaderPostRefs,i=0;i<c.length;i++)r[c[i]]=n;for(var d=e.outstandingPostRefs,i=0;i<d.length;i++)r[d[i]]=n;for(var g=e.userPostRefs,i=0;i<g.length;i++)r[g[i]]=n;return r},getPostsArray:function(s){var o=t.defer(),r=rootRef.child("leaderPosts/"+s.$id),n=[];return r.once("value").then(function(t){t.forEach(function(t){n.push(e.buildFromSnapshot(t))}),o.resolve(n)}),o.promise},getMainPostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)s.push("/posts/"+t[o].$id+"/leaders/"+e.$id);return s},getSourcePostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)s.push("/sourcePosts/"+t[o].source.id+"/"+t[o].category.id+"/"+t[o].$id+"/leaders/"+e.$id);return s},getCategoryPostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)s.push("/categoryPosts/"+t[o].category.id+"/"+t[o].$id+"/leaders/"+e.$id);return s},getHashtagPostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)void 0!=t[o].primaryHashtag&&void 0!=t[o].primaryHashtag.id&&(s.push("/hashtagPosts/"+t[o].primaryHashtag.id+"/"+t[o].$id+"/leaders/"+e.$id),void 0!=t[o].secondaryHashtags&&angular.forEach(t[o].secondaryHashtags,function(r){s.push("/hashtagPosts/"+r.id+"/"+t[o].$id+"/leaders/"+e.$id)}));return s},getLeaderPostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)angular.forEach(t[o].leaders,function(e){s.push("/leaderPosts/"+e.id+"/"+t[o].$id+"/leaders/"+e.$id)});return s},getOutstandingPostRefs:function(t,e){for(var s=[],o=0;o<t.length;o++)t[o].outstanding&&s.push("/outstandingPosts/"+t[o].$id+"/leaders/"+e.$id);return s},getUserPostRefs:function(e){var s=t.defer(),o=rootRef.child("userPosts"),r=[];return o.once("value").then(function(t){t.forEach(function(t){t.forEach(function(s){e.$id in s.val().leaders&&r.push("/userPosts/"+t.key+"/"+s.key+"/leaders/"+e.$id)})}),s.resolve(r)}),s.promise}}}]);