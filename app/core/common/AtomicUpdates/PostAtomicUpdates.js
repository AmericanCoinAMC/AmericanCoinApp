app.factory("PostAtomicUpdates",["$q","PostObjectService",function(e,t){return{updatePost:function(s){var o=e.defer(),n={},a=t.buildMinified(s);return this.getUserPostRefs(s).then(angular.bind(this,function(e){for(var t=0;t<e.length;t++)n[e[t]]=a;n["/sourcePosts/"+s.source.id+"/"+s.category.id+"/"+s.$id]=a,n["/categoryPosts/"+s.category.id+"/"+s.$id]=a,s.outstanding?n["/outstandingPosts/"+s.$id]=a:this.deleteOutstandingPost(s),s.primaryHashtag?(this.deleteUnselectedHashtagPosts(s),n["/hashtagPosts/"+s.primaryHashtag.id+"/"+s.$id]=a,void 0!=s.secondaryHashtags&&angular.forEach(s.secondaryHashtags,function(e,t){n["/hashtagPosts/"+t+"/"+s.$id]=a})):this.deleteHashtagPosts(s),s.leaders?(this.deleteUnselectedLeaderPosts(s),angular.forEach(s.leaders,function(e,t){n["/leaderPosts/"+t+"/"+s.$id]=a})):this.deleteLeaderPosts(s),rootRef.update(n).then(function(){o.resolve(!0)}).catch(function(e){o.reject(e)})})).catch(function(e){o.reject(e)}),o.promise},deletePost:function(t){var s=e.defer(),o={};return this.getUserPostRefs(t).then(angular.bind(this,function(e){for(var n=0;n<e.length;n++)o[e[n]]={};o["/sourcePosts/"+t.source.id+"/"+t.category.id+"/"+t.$id]={},o["/categoryPosts/"+t.category.id+"/"+t.$id]={},t.outstanding&&(o["/outstandingPosts/"+t.$id]={}),t.primaryHashtag&&(o["/hashtagPosts/"+t.primaryHashtag.id+"/"+t.$id]={},void 0!=t.secondaryHashtags&&angular.forEach(t.secondaryHashtags,function(e,s){o["/hashtagPosts/"+s+"/"+t.$id]={}})),t.leaders&&angular.forEach(t.leaders,function(e,s){o["/leaderPosts/"+s+"/"+t.$id]={}}),rootRef.update(o).then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)})})).catch(function(e){s.reject(e)}),s.promise},getUserPostRefs:function(t){var s=e.defer(),o=rootRef.child("userPosts"),n=[];return o.once("value").then(function(e){e.forEach(function(e){e.forEach(function(s){s.key==t.$id&&n.push("/userPosts/"+e.key+"/"+s.key)})}),s.resolve(n)}),s.promise},deleteOutstandingPost:function(t){var s=e.defer(),o=rootRef.child("outstandingPosts/"+t.$id);return o.remove().then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)}),s.promise},deleteHashtagPosts:function(t){var s=e.defer(),o={},n=rootRef.child("hashtagPosts/");return n.once("value").then(function(e){e.forEach(function(e){o["/hashtagPosts/"+e.key+"/"+t.$id]={}}),rootRef.update(o).then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)})}),s.promise},deleteUnselectedHashtagPosts:function(t){var s=e.defer(),o={};null!=t.secondaryHashtags&&void 0!=t.secondaryHashtags||(t.secondaryHashtags={});var n=rootRef.child("hashtagPosts/");return n.once("value").then(function(e){e.forEach(function(e){e.key==t.primaryHashtag.id||e.key in t.secondaryHashtags||(o["/hashtagPosts/"+e.key+"/"+t.$id]={})}),rootRef.update(o).then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)})}),s.promise},deleteLeaderPosts:function(t){var s=e.defer(),o={},n=rootRef.child("leaderPosts/");return n.once("value").then(function(e){e.forEach(function(e){o["/leaderPosts/"+e.key+"/"+t.$id]={}}),rootRef.update(o).then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)})}),s.promise},deleteUnselectedLeaderPosts:function(t){var s=e.defer(),o={};null!=t.leaders&&void 0!=t.leaders||(t.leaders={});var n=rootRef.child("leaderPosts/");return n.once("value").then(function(e){e.forEach(function(e){e.key in t.leaders||(o["/leaderPosts/"+e.key+"/"+t.$id]={})}),rootRef.update(o).then(function(){s.resolve(!0)}).catch(function(e){s.reject(e)})}),s.promise}}}]);