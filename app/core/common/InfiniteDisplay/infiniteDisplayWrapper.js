app.directive("infiniteDisplayWrapper",["InfiniteDisplay","InfiniteDisplayFilters","InfiniteDisplaySort","$timeout","$http","$q","$rootScope","angularGridInstance",function(i,n,t,e,o,r,c,a){return{restrict:"E",scope:{config:"="},template:'<div ng-include="getWrapperUrl()"></div>',link:function(o,f,l){o.parentScope=o.config.parentScope||null,o.filters=o.config.filters||!1,o.dataSort=o.config.dataSort||"desc",o.contentLoaded=!1,o.initialize=function(){var n=r.defer();return o.initView(),o.initAgConfig(),o.initInstanceObject(),o.InfiniteDisplay=new i(o.instanceObject),o.initDeactivators(),o.InfiniteDisplay.initialize().then(function(){o.viewObject.delayedStart?e(function(){o.config.grid?e(function(){void 0!=a.infiniteScrollGrid&&a.infiniteScrollGrid.refresh(),o.contentLoaded=!0,n.resolve(!0)},1500):(o.contentLoaded=!0,n.resolve(!0))},500):o.config.grid?e(function(){void 0!=a.infiniteScrollGrid&&a.infiniteScrollGrid.refresh(),o.contentLoaded=!0,n.resolve(!0)},1500):(o.contentLoaded=!0,n.resolve(!0))}).catch(function(i){console.log(i)}),n.promise},o.initView=function(){o.viewObject={parentContainer:o.config.parentContainer||".views-container",distance:o.config.distance||2,templateUrl:o.config.templateUrl,delayedStart:o.config.delayedStart||!1,animation:o.config.animation||!1}},o.initAgConfig=function(){o.agConfig={gridWidth:o.config.gridWidth||300,gutterSize:o.config.gutterSize||20,refreshOnImgLoad:o.config.refreshOnImgLoad||!0}},o.initInstanceObject=function(){o.instanceObject={firstLotSize:o.config.firstLotSize||14,nextLotSize:o.config.nextLotSize||16,ref:o.config.ref,objectBuilder:o.config.objectBuilder}},o.getWrapperUrl=function(){var i="";return"infiniteScroll"==o.config.wrapper?i="/core/common/InfiniteDisplay/infiniteScrollWrapper.html":"loadMore"==o.config.wrapper&&(i="/core/common/InfiniteDisplay/loadMoreWrapper.html"),i},o.initDeactivators=function(){for(var i=0;i<o.config.deactivators.length;i++)c.$on(o.config.deactivators[i],function(){o.InfiniteDisplay.deactivate()})},o.$watch("InfiniteDisplay.items",function(i,n){void 0!=i&&(o.InfiniteDisplay.items=i,e(function(){o.InfiniteDisplay.items=o.processItems()}))},!0),o.processItems=function(){var i=o.InfiniteDisplay.getItems();if(o.filters)for(var e=0;e<o.filters.length;e++)i=i.filter(n[o.filters[e]]);return i.sort(t[o.dataSort]),i},o.initialize()}}}]);