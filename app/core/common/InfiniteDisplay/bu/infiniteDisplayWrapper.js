app.directive("infiniteDisplayWrapper",["InstanceManager","$timeout","$http","$q","$rootScope","angularGridInstance",function(n,i,t,e,r,o){return{restrict:"E",scope:{config:"="},template:'<div ng-include="initWrapper()"></div>',link:function(t,r,a){if(t.instanceIS=n.getInstance(t.config.instanceType),t.params={},t.controller={},t.filterEnabled=!1,t.dataFilters=[],t.contentLoaded=!1,void 0!=t.config.dataFilter&&(t.dataFilters.push(t.config.dataFilter),t.filterEnabled=!0),void 0!=t.config.builtInFilters){for(var c=0;c<t.config.builtInFilters.length;c++)switch(t.config.builtInFilters[c]){case"activeSources":t.dataFilters.push(function(n){return n.source.status.active});break;case"userIgnoredSources":t.dataFilters.push(function(n){var i=t.params.userIgnoredSources.isIgnored(n.source);return!i})}t.filterEnabled=!0}void 0!=t.config.controller&&(t.controller=t.config.controller),t.initWrapper=function(){var n="";return"infiniteScroll"==t.config.wrapper?n="/core/common/InfiniteDisplay/infiniteScrollWrapper.html":"loadMore"==t.config.wrapper&&(n="/core/common/InfiniteDisplay/loadMoreWrapper.html"),n},t.initParams=function(){void 0!=t.config.params&&angular.forEach(t.config.params,function(n,i){t.params[i]=n})},t.initConfigAg=function(){t.configAg={parentContainer:t.config.parentContainer||".views-container",distance:t.config.distance||2,gridWidth:t.config.gridWidth||300,gutterSize:t.config.gutterSize||20,refreshOnImgLoad:t.config.refreshOnImgLoad||!0,templateUrl:t.config.templateUrl,delayedStart:t.config.delayedStart||!1,animation:t.config.animation||!1}},t.initInstanceObject=function(){t.instanceObject={firstLotSize:t.config.firstLotSize||14,nextLotSize:t.config.nextLotSize||16,ref:t.config.ref,objectBuilder:t.config.objectBuilder,dataFilter:t.config.dataFilter||!1}},t.nextLot=function(){t.instanceIS.loadNextLot().then(function(){}).catch(function(n){console.log(n)})},t.filterEnabled?t.$watch("getItemsWithFilters()",function(n,i){void 0!=n&&(t.items=n)},!0):t.$watch("getItems()",function(n,i){void 0!=n&&(t.items=n)},!0),t.getItems=function(){return t.instanceIS.getItems()},t.getItemsWithFilters=function(){for(var n=t.instanceIS.getItems(),i=0;i<t.dataFilters.length;i++)n=n.filter(t.dataFilters[i]);return n},t.fetching=function(){return t.instanceIS.isFetching()},t.firstLotLoaded=function(){return t.instanceIS.isFirstLotLoaded()},t.itemsRemaining=function(){return t.instanceIS.itemsRemaining()},t.getDisplayedTotal=function(){return t.instanceIS.getDisplayedTotal()},t.initialize=function(){var n=e.defer();return t.initConfigAg(),t.initParams(),t.initInstanceObject(),t.instanceIS.initialize(t.instanceObject).then(function(){t.configAg.delayedStart?i(function(){t.config.grid?i(function(){void 0!=o.infiniteScrollGrid&&o.infiniteScrollGrid.refresh(),t.contentLoaded=!0,n.resolve(!0)},1500):(t.contentLoaded=!0,n.resolve(!0))},500):t.config.grid?i(function(){void 0!=o.infiniteScrollGrid&&o.infiniteScrollGrid.refresh(),t.contentLoaded=!0,n.resolve(!0)},1500):(t.contentLoaded=!0,n.resolve(!0))}).catch(function(n){console.log(n)}),n.promise},t.initialize()}}}]);