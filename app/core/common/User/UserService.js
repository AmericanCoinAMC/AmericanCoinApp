app.factory("UserService",["Auth","$state","$q","$rootScope",function(e,t,n,r){return{signIn:function(e){var t=n.defer();switch(e.provider){case"email":this.signInWithEmail(e).then(function(){t.resolve(!0)}).catch(function(e){t.reject(e)})}return t.promise},signInWithEmail:function(t){var r=n.defer();return e.$signInWithEmailAndPassword(t.email,t.password).then(function(){r.resolve(!0)}).catch(function(e){r.reject(e)}),r.promise},createAccount:function(e){var t=n.defer();return this.buildUserObject(e).then(angular.bind(this,function(e){switch(e.provider){case"email":this.createEmailUser(e).then(function(e){t.resolve(e)}).catch(function(e){t.reject(e)})}})).catch(function(e){t.reject(e)}),t.promise},createEmailUser:function(t){var r=n.defer();return e.$createUserWithEmailAndPassword(t.email,t.password).then(angular.bind(this,function(e){this.createUser(e.uid,t).then(function(){r.resolve(e)}).catch(function(e){r.reject(e)})})).catch(function(e){r.reject(e)}),r.promise},createUser:function(e,t){var r=n.defer();t.password=null;var i=rootRef.child("users/"+e);return i.set(t).then(function(){r.resolve(!0)}).catch(function(e){r.reject(e)}),r.promise},buildUserObject:function(e){var t=n.defer(),r=(new Date).getTime();e.eventDate=r,e[".priority"]=-r,e.authority=0,e.preferences={theme:"default",card:"expand"},e.isAdmin=!1,e.birthday=e.birthday.split("/");var i=e.birthday[1]+"/"+e.birthday[0]+"/"+e.birthday[2];return e.birthday=new Date(i).getTime(),UserInfo.getInfo(function(n){e.location={continent:{name:n.continent.name,short:n.continent.code},country:{name:n.country.name,short:n.country.code},city:{name:n.city.name}},t.resolve(e)},function(e){t.reject(e)}),t.promise},getAuthInfo:function(){return e.$getAuth()},getUserInfo:function(e){var t=n.defer();return rootRef.child("users/"+e).once("value").then(function(e){var n=e.val();n.$id=e.key,t.resolve(n)}).catch(function(e){t.reject(e)}),t.promise},emailExists:function(e){var t=n.defer(),r=rootRef.child("users").orderByChild("email").equalTo(e);return r.once("value").then(function(e){t.resolve(e.exists())}).catch(function(e){t.reject(e)}),t.promise},signOut:function(){e.$signOut(),r.firebaseUser={},r.userInfo={}}}}]);